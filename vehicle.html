<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulador Tático Batmóvel - Gotham City</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* ===== RESET & BASE STYLES ===== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Courier New', monospace;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            background-color: #0a0a0f;
            color: #ffffff;
            background-image: 
                radial-gradient(circle at 10% 20%, rgba(0, 60, 120, 0.1) 0%, transparent 20%),
                radial-gradient(circle at 90% 80%, rgba(0, 120, 200, 0.1) 0%, transparent 20%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 10px;
            overflow-x: hidden;
            touch-action: manipulation;
        }

        /* ===== HEADER STYLES ===== */
        .header {
            text-align: center;
            margin-bottom: 10px;
            width: 100%;
            max-width: 1000px;
            padding: 0 10px;
        }

        .title {
            color: #00b4ff;
            font-size: clamp(1.5rem, 3vw, 2rem);
            margin-bottom: 5px;
            text-shadow: 0 0 15px rgba(0, 180, 255, 0.7);
            letter-spacing: 1px;
            line-height: 1.2;
        }

        .subtitle {
            color: #7ab8ff;
            font-size: clamp(0.8rem, 1.5vw, 1rem);
            margin-bottom: 5px;
            line-height: 1.3;
        }

        .bat-logo {
            color: #ffd700;
            font-size: clamp(1.5rem, 4vw, 2.2rem);
            margin-bottom: 5px;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { text-shadow: 0 0 5px #ffd700; }
            50% { text-shadow: 0 0 20px #ffd700, 0 0 30px #ffd700; }
            100% { text-shadow: 0 0 5px #ffd700; }
        }

        /* ===== MAIN CONTAINER - PROPORÇÃO 2:1 ===== */
        .container {
            display: flex;
            flex-direction: column;
            width: 100%;
            max-width: 1000px;
            height: 85vh;
            max-height: 800px;
            gap: 10px;
            padding: 0 10px;
        }

        /* JOGO (2 partes) - MAIOR */
        .simulation-viewport {
            position: relative;
            width: 100%;
            height: 66.66%; /* 2/3 da tela = 66.66% */
            min-height: 250px;
            border: 2px solid #1a3a5f;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 0 30px rgba(0, 60, 120, 0.5);
            background: linear-gradient(to bottom, #050810, #0a1525);
            flex-shrink: 0;
        }

        #gameCanvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
        }

        /* PAINEL DE CONTROLE (1 parte) - MENOR */
        .vehicle-control-panel {
            background: linear-gradient(145deg, #0d1522, #08101a);
            border: 1px solid #1a3a5f;
            border-radius: 8px;
            padding: 12px;
            box-shadow: 0 5px 20px rgba(0, 30, 60, 0.4);
            display: flex;
            flex-direction: column;
            gap: 12px;
            flex: 1;
            overflow-y: auto;
            min-height: 0;
            height: 33.33%; /* 1/3 da tela = 33.33% */
        }

        /* ===== HUD OVERLAY ===== */
        .crt-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%);
            background-size: 100% 4px;
            z-index: 2;
            pointer-events: none;
            opacity: 0.2;
        }

        .hud-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 3;
            pointer-events: none;
            padding: 8px;
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            grid-template-rows: auto 1fr auto;
        }

        .hud-left {
            grid-column: 1;
            grid-row: 1;
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .hud-center {
            grid-column: 2;
            grid-row: 3;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
        }

        .hud-right {
            grid-column: 3;
            grid-row: 1;
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 5px;
        }

        .hud-item {
            background: rgba(10, 25, 47, 0.9);
            border: 1px solid rgba(0, 180, 255, 0.4);
            border-radius: 4px;
            padding: 4px 8px;
            backdrop-filter: blur(4px);
            min-width: 70px;
            max-width: 100px;
        }

        .hud-label {
            color: #7ab8ff;
            font-size: 0.6rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 1px;
            white-space: nowrap;
        }

        .hud-value {
            color: #ffffff;
            font-size: 0.9rem;
            font-weight: bold;
            line-height: 1.2;
        }

        .hud-value#hudSpeed {
            color: #00ff88;
            text-shadow: 0 0 10px rgba(0, 255, 136, 0.5);
        }

        .hud-value#hudFuel {
            color: #ffaa00;
        }

        .hud-value#hudSystem {
            color: #00b4ff;
        }

        .radar-container {
            width: 60px;
            height: 60px;
            background: rgba(10, 25, 47, 0.8);
            border: 1px solid rgba(0, 180, 255, 0.4);
            border-radius: 50%;
            position: relative;
            overflow: hidden;
        }

        .radar-sweep {
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: conic-gradient(transparent 270deg, rgba(0, 180, 255, 0.3) 360deg);
            animation: radarSweep 2s linear infinite;
        }

        @keyframes radarSweep {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        /* ===== PAINEL COMPACTO ===== */
        .panel-title {
            color: #00d9ff;
            font-size: clamp(0.9rem, 2vw, 1.1rem);
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            gap: 6px;
            flex-wrap: wrap;
        }

        /* STATUS COMPACT */
        .status-compact {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 6px;
            margin-bottom: 6px;
        }

        .status-item-compact {
            background-color: rgba(10, 25, 47, 0.8);
            border: 1px solid #1a4a7a;
            border-radius: 5px;
            padding: 6px;
            transition: all 0.3s;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .status-label-compact {
            color: #7ab8ff;
            font-size: 0.6rem;
            margin-bottom: 2px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            line-height: 1.1;
        }

        .status-value-compact {
            color: #ffffff;
            font-size: 0.9rem;
            font-weight: bold;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.3);
            line-height: 1.2;
        }

        /* CONTROLES COMPACT */
        .vehicle-controls-compact {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 6px;
            margin: 4px 0;
        }

        .control-btn-compact {
            background: linear-gradient(145deg, #003366, #001a33);
            border: 1px solid #1a4a7a;
            color: #ffffff;
            padding: 8px 4px;
            border-radius: 6px;
            font-size: 0.75rem;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 3px;
            transition: all 0.2s;
            min-height: 55px;
        }

        .control-btn-compact:hover {
            background: linear-gradient(145deg, #004488, #002244);
            border-color: #00b4ff;
            transform: translateY(-2px);
        }

        .control-btn-compact:active {
            transform: translateY(1px);
        }

        .control-btn-compact.active {
            background: linear-gradient(145deg, #0066cc, #004488);
            border-color: #00b4ff;
            box-shadow: 0 0 15px rgba(0, 180, 255, 0.7);
        }

        .control-btn-compact i {
            font-size: 0.9rem;
        }

        /* SCORE DISPLAY COMPACT */
        .score-display-compact {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 6px;
            margin-bottom: 8px;
            padding: 6px 8px;
            background: rgba(10, 25, 47, 0.8);
            border: 1px solid #1a4a7a;
            border-radius: 6px;
        }

        .score-item-compact {
            text-align: center;
        }

        .score-label-compact {
            color: #7ab8ff;
            font-size: 0.55rem;
            text-transform: uppercase;
            letter-spacing: 0.6px;
            margin-bottom: 2px;
            line-height: 1.1;
        }

        .score-value-compact {
            color: #ffffff;
            font-size: 0.85rem;
            font-weight: bold;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.3);
            line-height: 1.2;
        }

        /* DIRECTION CONTROLS */
        .direction-controls-compact {
            display: none; /* Escondido no mobile */
            flex-direction: column;
            align-items: center;
            gap: 5px;
            margin: 5px 0;
        }

        .direction-row-compact {
            display: flex;
            gap: 6px;
            justify-content: center;
            width: 100%;
            max-width: 180px;
        }

        .direction-btn-compact {
            width: 45px;
            height: 45px;
            background: linear-gradient(145deg, #003366, #001a33);
            border: 2px solid #1a4a7a;
            color: #ffffff;
            border-radius: 50%;
            font-size: 1rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.1s;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.3);
            touch-action: manipulation;
            user-select: none;
        }

        /* LOG COMPACT */
        .system-log-compact {
            background-color: rgba(5, 15, 30, 0.9);
            border: 1px solid #1a4a7a;
            border-radius: 6px;
            padding: 8px;
            margin-top: 5px;
            flex: 1;
            min-height: 80px;
            max-height: 100px;
            display: flex;
            flex-direction: column;
        }

        .system-log-compact div:first-child {
            color: #00d9ff;
            font-size: 0.7rem;
            margin-bottom: 4px;
        }

        .log-content-compact {
            background-color: rgba(0, 0, 0, 0.7);
            border: 1px solid #0a3a5a;
            border-radius: 4px;
            padding: 6px;
            flex: 1;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 0.7rem;
            line-height: 1.2;
            color: #00ffaa;
        }

        /* ===== GAME OVER ===== */
        .game-over {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 10;
            color: white;
            font-size: clamp(1.2rem, 3vw, 1.8rem);
            text-align: center;
            padding: 15px;
            backdrop-filter: blur(5px);
        }

        .game-over h2 {
            color: #ff4444;
            margin-bottom: 10px;
            text-shadow: 0 0 20px rgba(255, 68, 68, 0.7);
        }

        .game-over p {
            margin: 6px 0;
            font-size: 0.8rem;
        }

        .restart-btn {
            background: linear-gradient(145deg, #0066cc, #004488);
            border: 2px solid #00b4ff;
            color: white;
            padding: 10px 20px;
            border-radius: 6px;
            font-size: 0.9rem;
            cursor: pointer;
            margin-top: 10px;
            transition: all 0.3s;
            font-weight: bold;
        }

        .restart-btn:hover {
            background: linear-gradient(145deg, #0088cc, #0066aa);
            box-shadow: 0 0 20px rgba(0, 180, 255, 0.7);
        }

        /* ===== MOBILE CONTROLS ===== */
        .mobile-controls {
            display: flex;
            position: fixed;
            bottom: 10px;
            left: 10px;
            right: 10px;
            z-index: 20;
            justify-content: space-between;
            align-items: center;
            pointer-events: none;
        }

        .mobile-joystick {
            width: 90px;
            height: 90px;
            border-radius: 50%;
            background: rgba(10, 25, 47, 0.7);
            border: 2px solid rgba(0, 180, 255, 0.4);
            position: relative;
            pointer-events: auto;
            touch-action: none;
        }

        .mobile-joystick-knob {
            position: absolute;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            background: linear-gradient(145deg, #0066cc, #004488);
            border: 2px solid #00b4ff;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            pointer-events: none;
        }

        .mobile-action-buttons {
            display: flex;
            flex-direction: column;
            gap: 6px;
            pointer-events: auto;
        }

        .mobile-action-btn {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background: linear-gradient(145deg, #003366, #001a33);
            border: 2px solid #ffaa00;
            color: white;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            touch-action: manipulation;
            user-select: none;
        }

        /* ===== FOOTER ===== */
        .footer {
            margin-top: 10px;
            text-align: center;
            color: #7ab8ff;
            font-size: 0.7rem;
            padding: 10px;
            width: 100%;
            max-width: 1000px;
            border-top: 1px solid #1a3a5f;
            line-height: 1.4;
        }

        /* ===== EFFECTS ===== */
        .fuel-warning {
            color: #ff4444 !important;
            animation: blink 1s infinite;
        }

        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }

        .turbo-active {
            color: #ffaa00 !important;
            text-shadow: 0 0 10px rgba(255, 170, 0, 0.7) !important;
        }

        .camouflage-active {
            color: #aa66ff !important;
            text-shadow: 0 0 10px rgba(170, 102, 255, 0.7) !important;
        }

        /* ===== RESPONSIVE DESIGN ===== */
        @media (min-width: 768px) {
            .container {
                height: 80vh;
            }
            
            .simulation-viewport {
                height: 66.66%;
                min-height: 300px;
            }
            
            .vehicle-control-panel {
                height: 33.33%;
                min-height: 200px;
                padding: 15px;
            }
            
            .score-display-compact {
                grid-template-columns: repeat(4, 1fr);
            }
            
            /* Mostrar controles de direção no desktop */
            .direction-controls-compact {
                display: flex;
            }
            
            /* Ajustar tamanhos para desktop */
            .control-btn-compact {
                padding: 10px 6px;
                min-height: 65px;
                font-size: 0.8rem;
            }
            
            .control-btn-compact i {
                font-size: 1rem;
            }
            
            .status-item-compact {
                padding: 8px;
            }
            
            .status-label-compact {
                font-size: 0.65rem;
            }
            
            .status-value-compact {
                font-size: 1rem;
            }
            
            .hud-item {
                min-width: 80px;
                padding: 6px 10px;
            }
            
            .hud-label {
                font-size: 0.65rem;
            }
            
            .hud-value {
                font-size: 0.95rem;
            }
            
            .radar-container {
                width: 70px;
                height: 70px;
            }
            
            /* Esconder controles mobile no desktop */
            .mobile-controls {
                display: none;
            }
            
            .system-log-compact {
                max-height: 120px;
            }
        }

        @media (max-width: 767px) {
            .container {
                height: 82vh;
                gap: 8px;
            }
            
            .simulation-viewport {
                height: 66.66%;
                min-height: 200px;
            }
            
            .vehicle-control-panel {
                height: 33.33%;
                padding: 10px;
                gap: 8px;
            }
            
            .status-compact {
                grid-template-columns: repeat(4, 1fr);
                gap: 4px;
            }
            
            .status-item-compact {
                padding: 4px;
            }
            
            .status-label-compact {
                font-size: 0.5rem;
            }
            
            .status-value-compact {
                font-size: 0.75rem;
            }
            
            .vehicle-controls-compact {
                gap: 4px;
            }
            
            .control-btn-compact {
                padding: 6px 3px;
                min-height: 50px;
                font-size: 0.65rem;
            }
            
            .control-btn-compact i {
                font-size: 0.8rem;
            }
            
            .score-display-compact {
                padding: 4px 6px;
                gap: 4px;
            }
            
            .score-label-compact {
                font-size: 0.5rem;
            }
            
            .score-value-compact {
                font-size: 0.75rem;
            }
            
            .hud-item {
                min-width: 60px;
                padding: 3px 5px;
            }
            
            .hud-label {
                font-size: 0.5rem;
            }
            
            .hud-value {
                font-size: 0.75rem;
            }
            
            .radar-container {
                width: 50px;
                height: 50px;
            }
            
            .log-content-compact {
                font-size: 0.6rem;
                padding: 4px;
            }
            
            .system-log-compact div:first-child {
                font-size: 0.65rem;
            }
            
            /* Mostrar controles mobile */
            .mobile-controls {
                display: flex;
            }
            
            /* Esconder controles de direção desktop */
            .direction-controls-compact {
                display: none;
            }
        }

        @media (max-width: 480px) {
            .container {
                height: 85vh;
            }
            
            .simulation-viewport {
                height: 66.66%;
                min-height: 180px;
            }
            
            .vehicle-control-panel {
                height: 33.33%;
            }
            
            .title {
                font-size: 1.3rem;
            }
            
            .subtitle {
                font-size: 0.75rem;
            }
            
            .bat-logo {
                font-size: 1.5rem;
            }
            
            .panel-title {
                font-size: 0.85rem;
            }
            
            .status-compact {
                grid-template-columns: repeat(2, 1fr);
                gap: 4px;
            }
            
            .mobile-joystick {
                width: 80px;
                height: 80px;
            }
            
            .mobile-joystick-knob {
                width: 30px;
                height: 30px;
            }
            
            .mobile-action-btn {
                width: 40px;
                height: 40px;
                font-size: 0.8rem;
            }
        }

        @media (max-width: 360px) {
            .simulation-viewport {
                height: 66.66%;
                min-height: 160px;
            }
            
            .vehicle-control-panel {
                height: 33.33%;
            }
            
            .title {
                font-size: 1.1rem;
            }
            
            .status-compact {
                grid-template-columns: 1fr;
                gap: 3px;
            }
        }

        /* Para telas muito altas */
        @media (min-height: 800px) {
            .container {
                height: 75vh;
                max-height: 850px;
            }
            
            .simulation-viewport {
                height: 66.66%;
                min-height: 350px;
            }
            
            .vehicle-control-panel {
                height: 33.33%;
                min-height: 250px;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="bat-logo">
            <i class="fas fa-mask"></i>
        </div>
        <h1 class="title">SIMULADOR BATMÓVEL</h1>
        <p class="subtitle">Sistema WayneTech - Gotham City</p>
    </div>

    <div class="container">
        <!-- Viewport de Simulação (2 PARTES - MAIOR) -->
        <div class="simulation-viewport">
            <canvas id="gameCanvas"></canvas>
            <div class="crt-overlay"></div>
            
            <!-- HUD Overlay -->
            <div class="hud-overlay">
                <div class="hud-left">
                    <div class="hud-item">
                        <div class="hud-label">VELOCIDADE</div>
                        <div class="hud-value" id="hudSpeed">0 km/h</div>
                    </div>
                    <div class="hud-item">
                        <div class="hud-label">COMBUSTÍVEL</div>
                        <div class="hud-value" id="hudFuel">100%</div>
                    </div>
                </div>
                
                <div class="hud-center">
                    <div class="hud-item">
                        <div class="hud-label">SISTEMA</div>
                        <div class="hud-value" id="hudSystem">OFFLINE</div>
                    </div>
                    <div class="radar-container">
                        <div class="radar-sweep"></div>
                    </div>
                </div>
                
                <div class="hud-right">
                    <div class="hud-item">
                        <div class="hud-label">PONTOS</div>
                        <div class="hud-value" id="hudScore">0</div>
                    </div>
                    <div class="hud-item">
                        <div class="hud-label">DISTÂNCIA</div>
                        <div class="hud-value" id="hudDistance">0 m</div>
                    </div>
                </div>
            </div>
            
            <!-- Tela de Game Over -->
            <div class="game-over" id="gameOverScreen">
                <h2>MISSÃO FALHOU</h2>
                <p id="gameOverReason"></p>
                <p>Pontuação: <span id="finalScore">0</span></p>
                <p>Distância: <span id="finalDistance">0</span>m</p>
                <button class="restart-btn" onclick="restartGame()">
                    <i class="fas fa-redo"></i> REINICIAR
                </button>
            </div>
        </div>

        <!-- Painel de Controle Compacto (1 PARTE - MENOR) -->
        <div class="vehicle-control-panel">
            <!-- Score Display Compacto -->
            <div class="score-display-compact">
                <div class="score-item-compact">
                    <div class="score-label-compact">PONTUAÇÃO</div>
                    <div class="score-value-compact" id="scoreValue">0</div>
                </div>
                <div class="score-item-compact">
                    <div class="score-label-compact">DISTÂNCIA</div>
                    <div class="score-value-compact" id="distanceValue">0 m</div>
                </div>
                <div class="score-item-compact">
                    <div class="score-label-compact">OBSTÁCULOS</div>
                    <div class="score-value-compact" id="obstaclesValue">0</div>
                </div>
                <div class="score-item-compact">
                    <div class="score-label-compact">VEL. MÁX</div>
                    <div class="score-value-compact" id="maxSpeedValue">0 km/h</div>
                </div>
            </div>
            
            <div class="panel-title">
                <i class="fas fa-gamepad"></i>
                CONTROLES TÁTICOS
            </div>
            
            <!-- Status Compacto -->
            <div class="status-compact">
                <div class="status-item-compact">
                    <div class="status-label-compact">VELOCIDADE</div>
                    <div class="status-value-compact" id="batmobileSpeed">0 km/h</div>
                </div>
                <div class="status-item-compact">
                    <div class="status-label-compact">COMBUSTÍVEL</div>
                    <div class="status-value-compact" id="batmobileFuel">100%</div>
                </div>
                <div class="status-item-compact">
                    <div class="status-label-compact">SISTEMAS</div>
                    <div class="status-value-compact" id="batmobileSystems">OFFLINE</div>
                </div>
                <div class="status-item-compact">
                    <div class="status-label-compact">DANOS</div>
                    <div class="status-value-compact" id="batmobileDamage">0%</div>
                </div>
            </div>

            <!-- Controles de Ação Compactos -->
            <div class="vehicle-controls-compact">
                <button class="control-btn-compact" id="startBtn" onclick="gameEngine.start()">
                    <i class="fas fa-play"></i>
                    <span>LIGAR</span>
                </button>
                <button class="control-btn-compact" id="stopBtn" onclick="gameEngine.stop()">
                    <i class="fas fa-stop"></i>
                    <span>PARAR</span>
                </button>
                <button class="control-btn-compact" id="turboBtn" onclick="gameEngine.toggleTurbo()">
                    <i class="fas fa-bolt"></i>
                    <span>TURBO</span>
                </button>
                <button class="control-btn-compact" id="camouflageBtn" onclick="gameEngine.toggleCamouflage()">
                    <i class="fas fa-eye-slash"></i>
                    <span>CAMUFLAR</span>
                </button>
            </div>

            <!-- Controles de Direção (Desktop) -->
            <div class="direction-controls-compact">
                <div class="direction-row-compact">
                    <button class="direction-btn-compact" id="upBtn">
                        <i class="fas fa-chevron-up"></i>
                    </button>
                </div>
                <div class="direction-row-compact">
                    <button class="direction-btn-compact" id="leftBtn">
                        <i class="fas fa-chevron-left"></i>
                    </button>
                    <button class="direction-btn-compact" id="downBtn">
                        <i class="fas fa-chevron-down"></i>
                    </button>
                    <button class="direction-btn-compact" id="rightBtn">
                        <i class="fas fa-chevron-right"></i>
                    </button>
                </div>
            </div>

            <!-- Log do Sistema Compacto -->
            <div class="system-log-compact">
                <div>LOG DO SISTEMA</div>
                <div class="log-content-compact" id="batmobileLog">
                    > Sistema inicializado<br>
                    > Aguardando ignição...
                </div>
            </div>
        </div>
    </div>

    <!-- Controles Mobile -->
    <div class="mobile-controls">
        <div class="mobile-joystick" id="mobileJoystick">
            <div class="mobile-joystick-knob" id="mobileJoystickKnob"></div>
        </div>
        <div class="mobile-action-buttons">
            <button class="mobile-action-btn" id="mobileTurboBtn">
                <i class="fas fa-bolt"></i>
            </button>
            <button class="mobile-action-btn" id="mobileBrakeBtn">
                <i class="fas fa-hand-paper"></i>
            </button>
        </div>
    </div>

    <div class="footer">
        <p>Simulador do Batmóvel | Sistema WayneTech v2.1</p>
        <p>Controles: Setas/WASD = Direção | Espaço = Turbo | C = Camuflagem</p>
        <p>© Wayne Enterprises - Gotham City</p>
    </div>

    <script>
        // ===========================================
        // SISTEMA DO BATMÓVEL - MOTOR DE JOGO REALISTA
        // ===========================================

        class GameEngine {
            constructor() {
                this.canvas = document.getElementById('gameCanvas');
                this.ctx = this.canvas.getContext('2d');
                
                this.width = this.canvas.width = this.canvas.offsetWidth;
                this.height = this.canvas.height = this.canvas.offsetHeight;
                
                // Estado do jogo
                this.gameState = 'READY';
                this.lastTime = 0;
                this.score = 0;
                this.distance = 0;
                this.maxSpeed = 0;
                this.obstaclesAvoided = 0;
                this.gameOver = false;
                this.timeOfDay = 'night'; // night, dusk, dawn
                
                // Jogador - Batmóvel Realista
                this.player = {
                    x: this.width / 2,
                    y: this.height * 0.8,
                    width: Math.min(120, this.width * 0.18),
                    height: Math.min(60, this.width * 0.09),
                    velocity: 0,
                    maxVelocity: 320,
                    acceleration: 0.25,
                    deceleration: 0.15,
                    moveSpeed: 8,
                    turbo: false,
                    camouflage: false,
                    fuel: 100,
                    damage: 0,
                    invincible: false,
                    invincibleTimer: 0,
                    lane: 1,
                    headlights: true,
                    brakeLights: false
                };
                
                // Controles
                this.keys = {};
                this.input = {
                    left: false,
                    right: false,
                    up: false,
                    down: false,
                    turbo: false
                };
                
                // Estrada Realista
                this.road = {
                    width: this.width * 0.8,
                    x: this.width * 0.1,
                    lines: [],
                    lineWidth: 3,
                    lineLength: 25,
                    lineGap: 30,
                    color: '#333333',
                    shoulderWidth: 40,
                    shoulderColor: '#555555',
                    hasCracks: true,
                    cracks: []
                };
                
                // Obstáculos Realistas
                this.obstacles = [];
                this.obstacleTypes = [
                    { 
                        name: 'Carro de Polícia', 
                        width: 80, 
                        height: 45, 
                        color: '#4a6fa5', 
                        lightColor: '#3b7dff',
                        score: 15 
                    },
                    { 
                        name: 'Caminhão', 
                        width: 110, 
                        height: 55, 
                        color: '#8b4513', 
                        lightColor: '#ff9900',
                        score: 25 
                    },
                    { 
                        name: 'Sedan', 
                        width: 70, 
                        height: 40, 
                        color: '#c0c0c0', 
                        lightColor: '#ffffff',
                        score: 10 
                    },
                    { 
                        name: 'SUV', 
                        width: 85, 
                        height: 50, 
                        color: '#2e8b57', 
                        lightColor: '#00ff55',
                        score: 20 
                    },
                    { 
                        name: 'Moto', 
                        width: 40, 
                        height: 25, 
                        color: '#dc143c', 
                        lightColor: '#ff4444',
                        score: 30 
                    }
                ];
                this.obstacleSpawnTimer = 0;
                this.obstacleSpawnRate = 120;
                
                // Cenário Urbano
                this.buildings = [];
                this.trees = [];
                this.lights = [];
                this.initCityscape();
                
                // Partículas Realistas
                this.particles = [];
                this.maxParticles = 150;
                this.smokeParticles = [];
                
                // Inicializar
                this.init();
            }
            
            init() {
                this.resizeCanvas();
                window.addEventListener('resize', () => this.resizeCanvas());
                this.setupInput();
                this.setupButtonControls();
                this.setupMobileControls();
                this.initRoadLines();
                this.initRoadCracks();
                this.log('Sistema WayneTech inicializado - Modo Realista Ativado');
                requestAnimationFrame((t) => this.gameLoop(t));
            }
            
            resizeCanvas() {
                this.width = this.canvas.width = this.canvas.offsetWidth;
                this.height = this.canvas.height = this.canvas.offsetHeight;
                
                this.player.x = this.width / 2;
                this.player.y = this.height * 0.8;
                this.player.width = Math.min(120, this.width * 0.18);
                this.player.height = Math.min(60, this.width * 0.09);
                
                this.road.width = this.width * 0.8;
                this.road.x = this.width * 0.1;
                
                this.initRoadLines();
                this.initRoadCracks();
                this.initCityscape();
            }
            
            initRoadLines() {
                this.road.lines = [];
                for (let i = 0; i < 20; i++) {
                    this.road.lines.push({
                        x: this.road.x + (this.road.width / 2),
                        y: i * (this.road.lineLength + this.road.lineGap),
                        dashed: i % 2 === 0
                    });
                }
            }
            
            initRoadCracks() {
                this.road.cracks = [];
                for (let i = 0; i < 10; i++) {
                    this.road.cracks.push({
                        x: this.road.x + Math.random() * this.road.width,
                        y: Math.random() * this.height * 2,
                        width: 2 + Math.random() * 4,
                        length: 20 + Math.random() * 60,
                        angle: Math.random() * Math.PI
                    });
                }
            }
            
            initCityscape() {
                // Prédios
                this.buildings = [];
                const numBuildings = 8;
                for (let i = 0; i < numBuildings; i++) {
                    const side = i % 2 === 0 ? 'left' : 'right';
                    const x = side === 'left' 
                        ? this.road.x - 150 - Math.random() * 100
                        : this.road.x + this.road.width + 50 + Math.random() * 100;
                    
                    this.buildings.push({
                        x: x,
                        y: this.height,
                        width: 40 + Math.random() * 80,
                        height: 80 + Math.random() * 200,
                        color: this.getRandomBuildingColor(),
                        windows: Math.floor(3 + Math.random() * 8),
                        litWindows: Math.floor(Math.random() * 5)
                    });
                }
                
                // Árvores
                this.trees = [];
                for (let i = 0; i < 12; i++) {
                    const side = i % 2 === 0 ? 'left' : 'right';
                    const x = side === 'left' 
                        ? this.road.x - 70 - Math.random() * 40
                        : this.road.x + this.road.width + 30 + Math.random() * 40;
                    
                    this.trees.push({
                        x: x,
                        y: this.height,
                        trunkHeight: 20 + Math.random() * 30,
                        trunkWidth: 5 + Math.random() * 8,
                        canopyHeight: 30 + Math.random() * 50,
                        canopyWidth: 25 + Math.random() * 35,
                        color: '#2d5016'
                    });
                }
                
                // Postes de luz
                this.lights = [];
                for (let i = 0; i < 15; i++) {
                    const side = i % 2 === 0 ? 'left' : 'right';
                    const x = side === 'left' 
                        ? this.road.x - 30
                        : this.road.x + this.road.width + 30;
                    
                    this.lights.push({
                        x: x,
                        y: i * 150,
                        on: true,
                        intensity: 0.7 + Math.random() * 0.3
                    });
                }
            }
            
            getRandomBuildingColor() {
                const colors = ['#3a506b', '#1c2541', '#0b132b', '#5d5d5d', '#4a4a4a', '#2d3047'];
                return colors[Math.floor(Math.random() * colors.length)];
            }
            
            gameLoop(timestamp) {
                const deltaTime = timestamp - this.lastTime;
                this.lastTime = timestamp;
                
                this.ctx.clearRect(0, 0, this.width, this.height);
                
                if (this.gameState === 'RUNNING' && !this.gameOver) {
                    this.update(deltaTime);
                }
                
                this.render();
                
                if (!this.gameOver) {
                    requestAnimationFrame((t) => this.gameLoop(t));
                }
            }
            
            update(deltaTime) {
                const delta = Math.min(deltaTime / 16.67, 2.0);
                
                // Movimento horizontal por faixas
                if (this.input.left && this.player.lane > 0) {
                    this.player.lane--;
                    this.input.left = false;
                }
                if (this.input.right && this.player.lane < 2) {
                    this.player.lane++;
                    this.input.right = false;
                }
                
                // Posicionar baseado na faixa com movimento suave
                const laneWidth = this.road.width / 3;
                const targetX = this.road.x + laneWidth * 0.5 + (this.player.lane * laneWidth);
                this.player.x += (targetX - this.player.x) * 0.15;
                
                // Aceleração realista
                if (this.gameState === 'RUNNING') {
                    const acceleration = this.player.turbo ? this.player.acceleration * 2.0 : this.player.acceleration;
                    this.player.velocity = Math.min(this.player.maxVelocity, this.player.velocity + acceleration * delta);
                    
                    // Luzes de freio
                    this.player.brakeLights = this.input.down || this.player.velocity < 10;
                }
                
                // Atualizar distância
                this.distance += this.player.velocity / 200 * delta;
                
                // Atualizar velocidade máxima
                if (this.player.velocity > this.maxSpeed) {
                    this.maxSpeed = this.player.velocity;
                }
                
                // Consumir combustível de forma realista
                if (this.player.velocity > 0) {
                    const consumption = this.player.turbo ? 0.8 : 0.15;
                    this.player.fuel = Math.max(0, this.player.fuel - consumption * (this.player.velocity / 800) * delta);
                    
                    if (this.player.fuel <= 0) {
                        this.gameOver = true;
                        this.showGameOver('Combustível esgotado!');
                    }
                }
                
                // Atualizar obstáculos
                this.updateObstacles(delta);
                
                // Atualizar partículas
                this.updateParticles(delta);
                
                // Atualizar fumaça do motor
                this.updateSmoke(delta);
                
                // Atualizar invencibilidade
                if (this.player.invincible) {
                    this.player.invincibleTimer -= delta;
                    if (this.player.invincibleTimer <= 0) {
                        this.player.invincible = false;
                    }
                }
                
                // Atualizar cenário
                this.updateCityscape(delta);
                
                // Atualizar UI
                this.updateUI();
            }
            
            updateObstacles(delta) {
                this.obstacleSpawnTimer += delta;
                if (this.obstacleSpawnTimer >= this.obstacleSpawnRate) {
                    this.spawnObstacle();
                    this.obstacleSpawnTimer = 0;
                }
                
                for (let i = this.obstacles.length - 1; i >= 0; i--) {
                    const obstacle = this.obstacles[i];
                    obstacle.y += (this.player.velocity / 40) * delta;
                    
                    if (!obstacle.hit && !this.player.invincible && !this.player.camouflage) {
                        const playerRect = {
                            x: this.player.x - this.player.width / 2,
                            y: this.player.y - this.player.height / 2,
                            width: this.player.width,
                            height: this.player.height
                        };
                        
                        const obstacleRect = {
                            x: obstacle.x - obstacle.width / 2,
                            y: obstacle.y - obstacle.height / 2,
                            width: obstacle.width,
                            height: obstacle.height
                        };
                        
                        if (this.checkCollision(playerRect, obstacleRect)) {
                            this.onCollision(obstacle);
                            obstacle.hit = true;
                        }
                    }
                    
                    if (obstacle.y > this.height + 100) {
                        if (!obstacle.hit) {
                            this.obstaclesAvoided++;
                            this.score += 10;
                        }
                        this.obstacles.splice(i, 1);
                    }
                }
            }
            
            spawnObstacle() {
                const type = this.obstacleTypes[Math.floor(Math.random() * this.obstacleTypes.length)];
                const lane = Math.floor(Math.random() * 3);
                const laneWidth = this.road.width / 3;
                const x = this.road.x + laneWidth * 0.5 + (lane * laneWidth);
                
                this.obstacles.push({
                    x: x,
                    y: -100,
                    width: type.width,
                    height: type.height,
                    color: type.color,
                    lightColor: type.lightColor,
                    score: type.score,
                    name: type.name,
                    lane: lane,
                    hit: false,
                    lightOn: Math.random() > 0.5,
                    lightIntensity: 0.7 + Math.random() * 0.3
                });
            }
            
            checkCollision(rect1, rect2) {
                return rect1.x < rect2.x + rect2.width &&
                       rect1.x + rect1.width > rect2.x &&
                       rect1.y < rect2.y + rect2.height &&
                       rect1.y + rect1.height > rect2.y;
            }
            
            onCollision(obstacle) {
                this.player.damage += 25;
                this.score += Math.max(1, obstacle.score - 10);
                
                this.createExplosion(obstacle.x, obstacle.y, obstacle.color);
                
                this.player.invincible = true;
                this.player.invincibleTimer = 40;
                
                this.player.velocity *= 0.5;
                
                if (this.player.damage >= 100) {
                    this.gameOver = true;
                    this.showGameOver(`Colisão fatal com ${obstacle.name}!`);
                } else {
                    this.log(`Colisão com ${obstacle.name}! Dano: ${this.player.damage}%`);
                }
            }
            
            updateParticles(delta) {
                for (let i = this.particles.length - 1; i >= 0; i--) {
                    const p = this.particles[i];
                    p.x += p.vx * delta;
                    p.y += p.vy * delta;
                    p.life -= delta;
                    
                    if (p.life <= 0) {
                        this.particles.splice(i, 1);
                    }
                }
            }
            
            updateSmoke(delta) {
                // Gerar fumaça do escapamento
                if (this.player.velocity > 20 && this.gameState === 'RUNNING') {
                    if (Math.random() < 0.3) {
                        this.smokeParticles.push({
                            x: this.player.x - this.player.width * 0.4 + Math.random() * this.player.width * 0.8,
                            y: this.player.y + this.player.height * 0.3,
                            vx: (Math.random() - 0.5) * 0.5,
                            vy: -Math.random() * 1.5,
                            size: 3 + Math.random() * 5,
                            life: 100 + Math.random() * 100,
                            color: this.player.turbo ? 'rgba(255, 100, 100, 0.8)' : 'rgba(100, 100, 100, 0.6)'
                        });
                    }
                }
                
                // Atualizar fumaça
                for (let i = this.smokeParticles.length - 1; i >= 0; i--) {
                    const p = this.smokeParticles[i];
                    p.x += p.vx * delta;
                    p.y += p.vy * delta;
                    p.life -= delta * 0.5;
                    p.size += 0.05 * delta;
                    
                    if (p.life <= 0) {
                        this.smokeParticles.splice(i, 1);
                    }
                }
            }
            
            updateCityscape(delta) {
                // Mover prédios e árvores para criar efeito de movimento
                const scrollSpeed = this.player.velocity / 800 * delta;
                
                this.lights.forEach(light => {
                    light.y += scrollSpeed * 30;
                    if (light.y > this.height + 100) {
                        light.y = -100;
                    }
                });
                
                this.road.cracks.forEach(crack => {
                    crack.y += scrollSpeed * 50;
                    if (crack.y > this.height + 100) {
                        crack.y = -100;
                        crack.x = this.road.x + Math.random() * this.road.width;
                    }
                });
            }
            
            createExplosion(x, y, color) {
                for (let i = 0; i < 25; i++) {
                    this.particles.push({
                        x: x,
                        y: y,
                        vx: (Math.random() - 0.5) * 12,
                        vy: (Math.random() - 0.5) * 12 - 4,
                        size: Math.random() * 4 + 2,
                        life: 60 + Math.random() * 60,
                        color: color,
                        type: 'explosion'
                    });
                }
                
                // Adicionar fragmentos de metal
                for (let i = 0; i < 10; i++) {
                    this.particles.push({
                        x: x,
                        y: y,
                        vx: (Math.random() - 0.5) * 8,
                        vy: (Math.random() - 0.5) * 8 - 2,
                        size: 1 + Math.random() * 2,
                        life: 120 + Math.random() * 120,
                        color: '#cccccc',
                        type: 'metal'
                    });
                }
            }
            
            render() {
                this.renderSky();
                this.renderCityscape();
                this.renderRoad();
                this.renderObstacles();
                this.renderParticles();
                this.renderSmoke();
                this.renderPlayer();
                this.renderSpecialEffects();
                this.renderHeadlights();
            }
            
            renderSky() {
                // Céu noturno de Gotham
                const gradient = this.ctx.createLinearGradient(0, 0, 0, this.height);
                gradient.addColorStop(0, '#0a0a1a');
                gradient.addColorStop(0.5, '#1a1a2e');
                gradient.addColorStop(1, '#0f0f23');
                this.ctx.fillStyle = gradient;
                this.ctx.fillRect(0, 0, this.width, this.height);
                
                // Estrelas
                this.ctx.fillStyle = '#ffffff';
                this.ctx.globalAlpha = 0.6;
                for (let i = 0; i < 50; i++) {
                    const x = (i * 79) % this.width;
                    const y = (i * 53) % (this.height * 0.7);
                    const size = Math.random() * 1.5;
                    this.ctx.beginPath();
                    this.ctx.arc(x, y, size, 0, Math.PI * 2);
                    this.ctx.fill();
                }
                this.ctx.globalAlpha = 1;
                
                // Lua
                this.ctx.fillStyle = '#f0f0f0';
                this.ctx.beginPath();
                this.ctx.arc(this.width * 0.85, this.height * 0.15, 25, 0, Math.PI * 2);
                this.ctx.fill();
                
                this.ctx.fillStyle = '#e0e0e0';
                this.ctx.beginPath();
                this.ctx.arc(this.width * 0.82, this.height * 0.13, 8, 0, Math.PI * 2);
                this.ctx.fill();
            }
            
            renderCityscape() {
                // Renderizar prédios
                this.buildings.forEach(building => {
                    this.ctx.fillStyle = building.color;
                    this.ctx.fillRect(building.x - building.width/2, building.y - building.height, building.width, building.height);
                    
                    // Janelas
                    this.ctx.fillStyle = building.litWindows > 0 ? '#ffcc00' : '#1a1a1a';
                    const windowWidth = building.width / (building.windows + 1);
                    const windowHeight = building.height / 15;
                    
                    for (let i = 1; i <= building.windows; i++) {
                        for (let j = 1; j <= 10; j++) {
                            if (Math.random() < 0.3 || j <= building.litWindows) {
                                this.ctx.fillRect(
                                    building.x - building.width/2 + i * windowWidth - windowWidth/2,
                                    building.y - building.height + j * (building.height/12),
                                    windowWidth * 0.7,
                                    windowHeight * 0.7
                                );
                            }
                        }
                    }
                });
                
                // Renderizar árvores
                this.trees.forEach(tree => {
                    // Tronco
                    this.ctx.fillStyle = '#5d4037';
                    this.ctx.fillRect(
                        tree.x - tree.trunkWidth/2,
                        tree.y - tree.trunkHeight,
                        tree.trunkWidth,
                        tree.trunkHeight
                    );
                    
                    // Copa
                    this.ctx.fillStyle = tree.color;
                    this.ctx.beginPath();
                    this.ctx.ellipse(
                        tree.x,
                        tree.y - tree.trunkHeight - tree.canopyHeight/2,
                        tree.canopyWidth/2,
                        tree.canopyHeight/2,
                        0, 0, Math.PI * 2
                    );
                    this.ctx.fill();
                });
                
                // Postes de luz
                this.lights.forEach(light => {
                    // Poste
                    this.ctx.fillStyle = '#555555';
                    this.ctx.fillRect(light.x - 2, light.y - 80, 4, 80);
                    
                    // Luminária
                    this.ctx.fillStyle = '#666666';
                    this.ctx.fillRect(light.x - 8, light.y - 80, 16, 10);
                    
                    // Luz
                    if (light.on) {
                        const gradient = this.ctx.createRadialGradient(
                            light.x, light.y - 75,
                            0,
                            light.x, light.y - 75,
                            60
                        );
                        gradient.addColorStop(0, `rgba(255, 255, 200, ${light.intensity})`);
                        gradient.addColorStop(1, 'rgba(255, 255, 200, 0)');
                        
                        this.ctx.fillStyle = gradient;
                        this.ctx.beginPath();
                        this.ctx.arc(light.x, light.y - 75, 60, 0, Math.PI * 2);
                        this.ctx.fill();
                    }
                });
            }
            
            renderRoad() {
                // Acostamento
                this.ctx.fillStyle = this.road.shoulderColor;
                this.ctx.fillRect(this.road.x - this.road.shoulderWidth, 0, this.road.shoulderWidth, this.height);
                this.ctx.fillRect(this.road.x + this.road.width, 0, this.road.shoulderWidth, this.height);
                
                // Asfalto
                this.ctx.fillStyle = this.road.color;
                this.ctx.fillRect(this.road.x, 0, this.road.width, this.height);
                
                // Rachaduras no asfalto
                this.ctx.strokeStyle = '#444444';
                this.ctx.lineWidth = 2;
                this.road.cracks.forEach(crack => {
                    this.ctx.save();
                    this.ctx.translate(crack.x, crack.y);
                    this.ctx.rotate(crack.angle);
                    this.ctx.beginPath();
                    this.ctx.moveTo(0, 0);
                    this.ctx.lineTo(0, crack.length);
                    this.ctx.stroke();
                    this.ctx.restore();
                });
                
                // Faixas da pista
                this.ctx.strokeStyle = '#ffaa00';
                this.ctx.lineWidth = this.road.lineWidth;
                this.ctx.setLineDash([this.road.lineLength, this.road.lineGap]);
                
                for (let line of this.road.lines) {
                    line.y += this.player.velocity / 60;
                    if (line.y > this.height) {
                        line.y = -this.road.lineLength;
                    }
                    
                    this.ctx.beginPath();
                    this.ctx.moveTo(line.x, line.y);
                    this.ctx.lineTo(line.x, line.y + this.road.lineLength);
                    this.ctx.stroke();
                }
                
                this.ctx.setLineDash([]);
                
                // Divisórias de faixa
                this.ctx.strokeStyle = 'rgba(255, 255, 255, 0.3)';
                this.ctx.lineWidth = 1;
                for (let i = 1; i <= 2; i++) {
                    const x = this.road.x + (this.road.width / 3) * i;
                    this.ctx.beginPath();
                    this.ctx.moveTo(x, 0);
                    this.ctx.lineTo(x, this.height);
                    this.ctx.stroke();
                }
            }
            
            renderObstacles() {
                for (const obstacle of this.obstacles) {
                    if (obstacle.hit) continue;
                    
                    // Corpo do veículo
                    this.ctx.fillStyle = obstacle.color;
                    this.ctx.fillRect(
                        obstacle.x - obstacle.width / 2,
                        obstacle.y - obstacle.height / 2,
                        obstacle.width,
                        obstacle.height
                    );
                    
                    // Janelas
                    this.ctx.fillStyle = '#1a1a1a';
                    this.ctx.fillRect(
                        obstacle.x - obstacle.width / 2 + 5,
                        obstacle.y - obstacle.height / 2 + 5,
                        obstacle.width - 10,
                        obstacle.height * 0.4
                    );
                    
                    // Faróis
                    if (obstacle.lightOn) {
                        this.ctx.fillStyle = obstacle.lightColor;
                        this.ctx.fillRect(
                            obstacle.x - obstacle.width / 2 + 3,
                            obstacle.y + obstacle.height / 2 - 8,
                            6, 4
                        );
                        this.ctx.fillRect(
                            obstacle.x + obstacle.width / 2 - 9,
                            obstacle.y + obstacle.height / 2 - 8,
                            6, 4
                        );
                    }
                    
                    // Rodas
                    this.ctx.fillStyle = '#222222';
                    // Rodas dianteiras
                    this.ctx.fillRect(
                        obstacle.x - obstacle.width / 2 + 8,
                        obstacle.y - obstacle.height / 2 - 3,
                        10, 6
                    );
                    this.ctx.fillRect(
                        obstacle.x + obstacle.width / 2 - 18,
                        obstacle.y - obstacle.height / 2 - 3,
                        10, 6
                    );
                    // Rodas traseiras
                    this.ctx.fillRect(
                        obstacle.x - obstacle.width / 2 + 8,
                        obstacle.y + obstacle.height / 2 - 3,
                        10, 6
                    );
                    this.ctx.fillRect(
                        obstacle.x + obstacle.width / 2 - 18,
                        obstacle.y + obstacle.height / 2 - 3,
                        10, 6
                    );
                }
            }
            
            renderPlayer() {
                this.ctx.save();
                
                if (this.player.invincible && Math.floor(this.player.invincibleTimer / 3) % 2 === 0) {
                    this.ctx.globalAlpha = 0.6;
                }
                
                if (this.player.camouflage) {
                    this.ctx.globalAlpha = 0.3;
                }
                
                // Corpo principal do Batmóvel
                const gradient = this.ctx.createLinearGradient(
                    this.player.x - this.player.width/2,
                    this.player.y,
                    this.player.x + this.player.width/2,
                    this.player.y
                );
                gradient.addColorStop(0, '#000000');
                gradient.addColorStop(0.5, '#111111');
                gradient.addColorStop(1, '#000000');
                
                this.ctx.fillStyle = gradient;
                this.ctx.fillRect(
                    this.player.x - this.player.width / 2,
                    this.player.y - this.player.height / 2,
                    this.player.width,
                    this.player.height
                );
                
                // Para-choque dianteiro
                this.ctx.fillStyle = '#333333';
                this.ctx.fillRect(
                    this.player.x - this.player.width / 2,
                    this.player.y - this.player.height / 2,
                    this.player.width,
                    8
                );
                
                // Capô com detalhes
                this.ctx.fillStyle = '#222222';
                this.ctx.fillRect(
                    this.player.x - this.player.width / 2 + 5,
                    this.player.y - this.player.height / 2 + 10,
                    this.player.width - 10,
                    this.player.height - 25
                );
                
                // Emblema do Batman
                this.ctx.fillStyle = '#ffd700';
                this.ctx.beginPath();
                this.ctx.arc(this.player.x, this.player.y - this.player.height / 2 + 20, 8, 0, Math.PI * 2);
                this.ctx.fill();
                
                // Faróis
                this.ctx.fillStyle = this.player.headlights ? '#ffffff' : '#666666';
                this.ctx.fillRect(
                    this.player.x - this.player.width / 2 + 15,
                    this.player.y - this.player.height / 2 + 5,
                    12, 6
                );
                this.ctx.fillRect(
                    this.player.x + this.player.width / 2 - 27,
                    this.player.y - this.player.height / 2 + 5,
                    12, 6
                );
                
                // Luzes de freio
                this.ctx.fillStyle = this.player.brakeLights ? '#ff0000' : '#990000';
                this.ctx.fillRect(
                    this.player.x - this.player.width / 2 + 15,
                    this.player.y + this.player.height / 2 - 10,
                    10, 4
                );
                this.ctx.fillRect(
                    this.player.x + this.player.width / 2 - 25,
                    this.player.y + this.player.height / 2 - 10,
                    10, 4
                );
                
                // Escapamentos
                this.ctx.fillStyle = this.player.turbo ? '#ff6600' : '#555555';
                this.ctx.fillRect(
                    this.player.x - 8,
                    this.player.y + this.player.height / 2 - 5,
                    16, 4
                );
                
                // Rodas
                this.ctx.fillStyle = '#111111';
                // Rodas dianteiras
                this.ctx.fillRect(
                    this.player.x - this.player.width / 2 + 10,
                    this.player.y - this.player.height / 2 - 5,
                    15, 8
                );
                this.ctx.fillRect(
                    this.player.x + this.player.width / 2 - 25,
                    this.player.y - this.player.height / 2 - 5,
                    15, 8
                );
                // Rodas traseiras
                this.ctx.fillStyle = '#222222';
                this.ctx.fillRect(
                    this.player.x - this.player.width / 2 + 10,
                    this.player.y + this.player.height / 2 - 3,
                    15, 8
                );
                this.ctx.fillRect(
                    this.player.x + this.player.width / 2 - 25,
                    this.player.y + this.player.height / 2 - 3,
                    15, 8
                );
                
                // Detalhes das rodas
                this.ctx.fillStyle = '#444444';
                this.ctx.beginPath();
                this.ctx.arc(this.player.x - this.player.width / 2 + 17.5, this.player.y - this.player.height / 2 - 1, 4, 0, Math.PI * 2);
                this.ctx.fill();
                this.ctx.beginPath();
                this.ctx.arc(this.player.x + this.player.width / 2 - 17.5, this.player.y - this.player.height / 2 - 1, 4, 0, Math.PI * 2);
                this.ctx.fill();
                
                this.ctx.restore();
            }
            
            renderHeadlights() {
                if (this.player.headlights && this.gameState === 'RUNNING') {
                    const gradient = this.ctx.createRadialGradient(
                        this.player.x, this.player.y - this.player.height / 2,
                        0,
                        this.player.x, this.player.y - this.player.height / 2,
                        200
                    );
                    gradient.addColorStop(0, 'rgba(255, 255, 255, 0.8)');
                    gradient.addColorStop(0.3, 'rgba(255, 255, 200, 0.4)');
                    gradient.addColorStop(1, 'rgba(255, 255, 200, 0)');
                    
                    this.ctx.fillStyle = gradient;
                    this.ctx.beginPath();
                    this.ctx.moveTo(this.player.x - 50, this.player.y - this.player.height / 2);
                    this.ctx.lineTo(this.player.x - 150, 0);
                    this.ctx.lineTo(this.player.x + 150, 0);
                    this.ctx.lineTo(this.player.x + 50, this.player.y - this.player.height / 2);
                    this.ctx.closePath();
                    this.ctx.fill();
                }
            }
            
            renderParticles() {
                for (const p of this.particles) {
                    this.ctx.globalAlpha = p.life / 100;
                    
                    if (p.type === 'explosion') {
                        this.ctx.fillStyle = p.color;
                        this.ctx.beginPath();
                        this.ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
                        this.ctx.fill();
                    } else if (p.type === 'metal') {
                        this.ctx.fillStyle = p.color;
                        this.ctx.fillRect(p.x - p.size/2, p.y - p.size/2, p.size, p.size);
                    }
                }
                this.ctx.globalAlpha = 1;
            }
            
            renderSmoke() {
                for (const p of this.smokeParticles) {
                    this.ctx.globalAlpha = p.life / 100 * 0.6;
                    this.ctx.fillStyle = p.color;
                    this.ctx.beginPath();
                    this.ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
                    this.ctx.fill();
                }
                this.ctx.globalAlpha = 1;
            }
            
            renderSpecialEffects() {
                // Efeito de turbo
                if (this.player.turbo && this.player.velocity > 100) {
                    this.ctx.fillStyle = 'rgba(255, 100, 100, 0.1)';
                    this.ctx.fillRect(0, 0, this.width, this.height);
                }
                
                // Efeito de dano
                if (this.player.damage > 0) {
                    const intensity = Math.sin(Date.now() / 200) * 0.15 * (this.player.damage / 100);
                    this.ctx.fillStyle = `rgba(255, 0, 0, ${intensity})`;
                    this.ctx.fillRect(0, 0, this.width, this.height);
                }
                
                // Efeito de velocidade (motion blur)
                if (this.player.velocity > 200) {
                    this.ctx.fillStyle = `rgba(0, 0, 0, ${(this.player.velocity - 200) / 300 * 0.2})`;
                    this.ctx.fillRect(0, 0, this.width, this.height);
                }
            }
            
            updateUI() {
                document.getElementById('hudSpeed').textContent = `${Math.round(this.player.velocity)} km/h`;
                document.getElementById('hudFuel').textContent = `${Math.round(this.player.fuel)}%`;
                document.getElementById('hudSystem').textContent = this.gameState;
                document.getElementById('hudScore').textContent = this.score;
                document.getElementById('hudDistance').textContent = `${Math.round(this.distance)} m`;
                
                document.getElementById('batmobileSpeed').textContent = `${Math.round(this.player.velocity)} km/h`;
                document.getElementById('batmobileFuel').textContent = `${Math.round(this.player.fuel)}%`;
                document.getElementById('batmobileSystems').textContent = this.gameState;
                document.getElementById('batmobileDamage').textContent = `${Math.round(this.player.damage)}%`;
                
                document.getElementById('scoreValue').textContent = this.score;
                document.getElementById('distanceValue').textContent = `${Math.round(this.distance)} m`;
                document.getElementById('obstaclesValue').textContent = this.obstaclesAvoided;
                document.getElementById('maxSpeedValue').textContent = `${Math.round(this.maxSpeed)} km/h`;
                
                const fuelElement = document.getElementById('batmobileFuel');
                fuelElement.classList.toggle('fuel-warning', this.player.fuel < 20);
                
                const speedElement = document.getElementById('batmobileSpeed');
                speedElement.classList.toggle('turbo-active', this.player.turbo);
                
                const camouflageBtn = document.getElementById('camouflageBtn');
                camouflageBtn.classList.toggle('active', this.player.camouflage);
                
                const turboBtn = document.getElementById('turboBtn');
                turboBtn.classList.toggle('active', this.player.turbo);
                
                const startBtn = document.getElementById('startBtn');
                const stopBtn = document.getElementById('stopBtn');
                startBtn.classList.toggle('active', this.gameState === 'RUNNING');
                stopBtn.classList.toggle('active', this.gameState === 'PAUSED');
            }
            
            log(message) {
                const log = document.getElementById('batmobileLog');
                log.innerHTML = `> ${message}<br>` + log.innerHTML;
                
                const logs = log.innerHTML.split('<br>');
                if (logs.length > 6) {
                    log.innerHTML = logs.slice(0, 6).join('<br>');
                }
            }
            
            start() {
                if (this.gameState === 'RUNNING') return;
                if (this.player.fuel <= 0) {
                    this.log('Combustível insuficiente!');
                    return;
                }
                
                this.gameState = 'RUNNING';
                this.player.velocity = 50;
                this.player.headlights = true;
                this.log('Sistemas online - Modo Realista');
                this.log('Motor V8 iniciado');
                this.log('Faróis ativados');
            }
            
            stop() {
                if (this.gameState !== 'RUNNING') return;
                this.gameState = 'PAUSED';
                this.player.velocity = 0;
                this.player.turbo = false;
                this.player.brakeLights = true;
                this.log('Sistemas em pausa');
            }
            
            toggleTurbo() {
                if (this.gameState !== 'RUNNING') {
                    this.log('Ligue o motor primeiro');
                    return;
                }
                
                this.player.turbo = !this.player.turbo;
                this.log(`Turbo ${this.player.turbo ? 'ativado' : 'desativado'}`);
                
                if (this.player.turbo) {
                    // Efeito sonoro visual do turbo
                    for (let i = 0; i < 10; i++) {
                        this.smokeParticles.push({
                            x: this.player.x - this.player.width * 0.4 + Math.random() * this.player.width * 0.8,
                            y: this.player.y + this.player.height * 0.3,
                            vx: (Math.random() - 0.5) * 2,
                            vy: -Math.random() * 3,
                            size: 4 + Math.random() * 6,
                            life: 80 + Math.random() * 80,
                            color: 'rgba(255, 100, 100, 0.9)'
                        });
                    }
                }
            }
            
            toggleCamouflage() {
                this.player.camouflage = !this.player.camouflage;
                this.log(`Camuflagem ${this.player.camouflage ? 'ativada' : 'desativada'}`);
            }
            
            showGameOver(reason) {
                this.gameOver = true;
                this.gameState = 'GAME_OVER';
                document.getElementById('gameOverReason').textContent = reason;
                document.getElementById('finalScore').textContent = this.score;
                document.getElementById('finalDistance').textContent = Math.round(this.distance);
                document.getElementById('gameOverScreen').style.display = 'flex';
                this.log(`Missão falhou: ${reason}`);
            }
            
            setupInput() {
                window.addEventListener('keydown', (e) => {
                    const key = e.key.toLowerCase();
                    this.keys[key] = true;
                    this.updateInput();
                    
                    if (['arrowup', 'arrowdown', 'arrowleft', 'arrowright', ' '].includes(key)) {
                        e.preventDefault();
                    }
                    
                    if (key === ' ' && this.gameState === 'RUNNING') {
                        this.toggleTurbo();
                    }
                    
                    if (key === 'c') {
                        this.toggleCamouflage();
                    }
                    
                    if (key === 'h') {
                        this.player.headlights = !this.player.headlights;
                        this.log(`Faróis ${this.player.headlights ? 'ligados' : 'desligados'}`);
                    }
                    
                    if (key === 'r') {
                        this.resetPosition();
                    }
                });
                
                window.addEventListener('keyup', (e) => {
                    this.keys[e.key.toLowerCase()] = false;
                    this.updateInput();
                });
            }
            
            updateInput() {
                this.input.left = this.keys['a'] || this.keys['arrowleft'];
                this.input.right = this.keys['d'] || this.keys['arrowright'];
                this.input.up = this.keys['w'] || this.keys['arrowup'];
                this.input.down = this.keys['s'] || this.keys['arrowdown'];
            }
            
            setupButtonControls() {
                const buttons = {
                    leftBtn: 'left',
                    rightBtn: 'right',
                    upBtn: 'up',
                    downBtn: 'down'
                };
                
                for (const [btnId, direction] of Object.entries(buttons)) {
                    const btn = document.getElementById(btnId);
                    if (!btn) continue;
                    
                    btn.addEventListener('mousedown', (e) => {
                        e.preventDefault();
                        this.input[direction] = true;
                        btn.classList.add('active');
                    });
                    
                    btn.addEventListener('mouseup', () => {
                        this.input[direction] = false;
                        btn.classList.remove('active');
                    });
                    
                    btn.addEventListener('mouseleave', () => {
                        this.input[direction] = false;
                        btn.classList.remove('active');
                    });
                    
                    btn.addEventListener('touchstart', (e) => {
                        e.preventDefault();
                        this.input[direction] = true;
                        btn.classList.add('active');
                    });
                    
                    btn.addEventListener('touchend', (e) => {
                        e.preventDefault();
                        this.input[direction] = false;
                        btn.classList.remove('active');
                    });
                }
            }
            
            setupMobileControls() {
                const joystick = document.getElementById('mobileJoystick');
                const knob = document.getElementById('mobileJoystickKnob');
                const turboBtn = document.getElementById('mobileTurboBtn');
                const brakeBtn = document.getElementById('mobileBrakeBtn');
                
                if (!joystick) return;
                
                let isDragging = false;
                let startX, startY;
                let knobX = 0, knobY = 0;
                const maxDistance = 30;
                
                const startDrag = (x, y) => {
                    isDragging = true;
                    const rect = joystick.getBoundingClientRect();
                    startX = rect.left + rect.width / 2;
                    startY = rect.top + rect.height / 2;
                };
                
                const updateDrag = (x, y) => {
                    if (!isDragging) return;
                    
                    const dx = x - startX;
                    const dy = y - startY;
                    const distance = Math.sqrt(dx * dx + dy * dy);
                    
                    if (distance > maxDistance) {
                        const angle = Math.atan2(dy, dx);
                        knobX = Math.cos(angle) * maxDistance;
                        knobY = Math.sin(angle) * maxDistance;
                    } else {
                        knobX = dx;
                        knobY = dy;
                    }
                    
                    knob.style.transform = `translate(${knobX}px, ${knobY}px)`;
                    
                    this.input.left = knobX < -10;
                    this.input.right = knobX > 10;
                    this.input.up = knobY < -10;
                    this.input.down = knobY > 10;
                };
                
                const endDrag = () => {
                    isDragging = false;
                    knobX = knobY = 0;
                    knob.style.transform = 'translate(0, 0)';
                    this.input.left = this.input.right = this.input.up = this.input.down = false;
                };
                
                joystick.addEventListener('mousedown', (e) => {
                    startDrag(e.clientX, e.clientY);
                });
                
                document.addEventListener('mousemove', (e) => {
                    updateDrag(e.clientX, e.clientY);
                });
                
                document.addEventListener('mouseup', endDrag);
                
                joystick.addEventListener('touchstart', (e) => {
                    const touch = e.touches[0];
                    startDrag(touch.clientX, touch.clientY);
                });
                
                document.addEventListener('touchmove', (e) => {
                    if (!isDragging) return;
                    const touch = e.touches[0];
                    updateDrag(touch.clientX, touch.clientY);
                });
                
                document.addEventListener('touchend', endDrag);
                document.addEventListener('touchcancel', endDrag);
                
                if (turboBtn) {
                    turboBtn.addEventListener('click', () => this.toggleTurbo());
                    turboBtn.addEventListener('touchstart', (e) => {
                        e.preventDefault();
                        this.toggleTurbo();
                    });
                }
                
                if (brakeBtn) {
                    brakeBtn.addEventListener('click', () => {
                        this.input.down = true;
                        setTimeout(() => {
                            this.input.down = false;
                        }, 300);
                    });
                    brakeBtn.addEventListener('touchstart', (e) => {
                        e.preventDefault();
                        this.input.down = true;
                        setTimeout(() => {
                            this.input.down = false;
                        }, 300);
                    });
                }
            }
            
            resetPosition() {
                this.player.x = this.width / 2;
                this.player.lane = 1;
                this.log('Posição resetada');
            }
            
            restart() {
                this.gameOver = false;
                this.gameState = 'READY';
                this.score = 0;
                this.distance = 0;
                this.maxSpeed = 0;
                this.obstaclesAvoided = 0;
                
                this.player.velocity = 0;
                this.player.turbo = false;
                this.player.camouflage = false;
                this.player.fuel = 100;
                this.player.damage = 0;
                this.player.invincible = false;
                this.player.invincibleTimer = 0;
                this.player.lane = 1;
                this.player.headlights = true;
                this.player.brakeLights = false;
                
                this.obstacles = [];
                this.particles = [];
                this.smokeParticles = [];
                this.obstacleSpawnTimer = 0;
                this.obstacleSpawnRate = 120;
                
                this.input.left = this.input.right = this.input.up = this.input.down = false;
                this.keys = {};
                
                document.getElementById('gameOverScreen').style.display = 'none';
                
                this.log('Sistema reinicializado');
                this.log('Batmóvel pronto para ação');
                this.log('Aguardando ignição...');
                
                requestAnimationFrame((t) => this.gameLoop(t));
            }
        }
        
        let gameEngine;
        
        function restartGame() {
            if (gameEngine) {
                gameEngine.restart();
            }
        }
        
        document.addEventListener('DOMContentLoaded', () => {
            gameEngine = new GameEngine();
        });
    </script>
</body>
</html>