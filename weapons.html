<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Batman Weapons 3D</title>
    <style>
        * { 
            margin: 0; 
            padding: 0; 
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            background: #000;
            overflow: hidden;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            touch-action: none;
            height: 100vh;
            width: 100vw;
        }
        
        canvas {
            display: block;
            width: 100%;
            height: 100%;
        }
        
        /* UI para mobile */
        #mobileUI {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 100;
        }
        
        /* Bot√£o de info (vis√≠vel apenas mobile) */
        #mobileInfoBtn {
            position: absolute;
            top: 15px;
            right: 15px;
            width: 44px;
            height: 44px;
            border-radius: 50%;
            background: rgba(255, 204, 0, 0.9);
            border: none;
            color: #000;
            font-size: 20px;
            cursor: pointer;
            pointer-events: auto;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
            z-index: 101;
        }
        
        /* Grid de armas para mobile */
        #mobileWeaponsGrid {
            position: absolute;
            bottom: 15px;
            left: 0;
            width: 100%;
            display: flex;
            justify-content: center;
            gap: 8px;
            padding: 0 10px;
            pointer-events: auto;
            flex-wrap: nowrap;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: none;
            padding-bottom: env(safe-area-inset-bottom, 15px);
        }
        
        #mobileWeaponsGrid::-webkit-scrollbar {
            display: none;
        }
        
        .mobile-weapon-btn {
            flex: 0 0 auto;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border: 2px solid #ffcc00;
            background: rgba(20, 20, 30, 0.9);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 22px;
            color: #ffcc00;
            transition: all 0.2s ease;
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px);
        }
        
        .mobile-weapon-btn.active {
            background: #ffcc00;
            color: #000;
            transform: scale(1.1);
            box-shadow: 0 0 20px rgba(255, 204, 0, 0.7);
        }
        
        /* Controles touch para mobile */
        #touchControls {
            position: absolute;
            bottom: 90px;
            right: 15px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            pointer-events: auto;
        }
        
        .touch-control-btn {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border: 2px solid #ffcc00;
            background: rgba(20, 20, 30, 0.9);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 22px;
            color: #ffcc00;
            transition: all 0.2s;
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px);
        }
        
        .touch-control-btn:active {
            transform: scale(0.95);
            background: rgba(255, 204, 0, 0.3);
        }
        
        /* Modal responsivo */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            z-index: 1000;
            animation: fadeIn 0.3s ease;
            padding: env(safe-area-inset-top, 0) env(safe-area-inset-right, 0) env(safe-area-inset-bottom, 0) env(safe-area-inset-left, 0);
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 100%);
            border: 2px solid #ffcc00;
            border-radius: 20px;
            padding: 25px;
            width: calc(100% - 40px);
            max-width: 500px;
            max-height: calc(100vh - 100px);
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.8);
            animation: slideIn 0.4s ease;
        }
        
        @keyframes slideIn {
            from { transform: translate(-50%, -40%); opacity: 0; }
            to { transform: translate(-50%, -50%); opacity: 1; }
        }
        
        .modal-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .modal-icon {
            font-size: 40px;
            color: #ffcc00;
            flex-shrink: 0;
        }
        
        .modal-title {
            font-size: 24px;
            color: #ffcc00;
            text-transform: uppercase;
            letter-spacing: 1px;
            text-shadow: 0 0 10px rgba(255, 204, 0, 0.5);
            flex-grow: 1;
        }
        
        .close-modal {
            background: rgba(255, 204, 0, 0.2);
            border: 1px solid #ffcc00;
            border-radius: 50%;
            color: #ffcc00;
            font-size: 24px;
            cursor: pointer;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            flex-shrink: 0;
        }
        
        .close-modal:active {
            background: rgba(255, 204, 0, 0.4);
            transform: scale(0.95);
        }
        
        .modal-body {
            color: #ffffff;
            font-size: 16px;
            line-height: 1.6;
            text-align: center;
            padding: 20px 0;
            border-top: 1px solid rgba(255, 204, 0, 0.3);
            border-bottom: 1px solid rgba(255, 204, 0, 0.3);
            margin: 20px 0;
        }
        
        .modal-stats {
            display: flex;
            justify-content: space-around;
            gap: 10px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        .stat {
            text-align: center;
            flex: 1;
            min-width: 80px;
        }
        
        .stat-value {
            color: #ffcc00;
            font-size: 22px;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .stat-label {
            color: #888;
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .modal-footer {
            text-align: center;
            margin-top: 20px;
            color: #666;
            font-size: 14px;
            padding-top: 15px;
            border-top: 1px solid rgba(255, 204, 0, 0.1);
        }
        
        /* Gestos para mobile */
        #gestureHint {
            position: absolute;
            top: 70px;
            left: 0;
            width: 100%;
            text-align: center;
            color: rgba(255, 204, 0, 0.7);
            font-size: 13px;
            padding: 10px;
            pointer-events: none;
            animation: fadeOut 3s 5s forwards;
            background: linear-gradient(transparent, rgba(0, 0, 0, 0.5));
        }
        
        @keyframes fadeOut {
            to { opacity: 0; }
        }
        
        /* Desktop - oculto em mobile */
        #desktopUI {
            display: none;
        }
        
        /* Media queries para telas maiores */
        @media (min-width: 768px) {
            #mobileUI {
                display: none;
            }
            
            #desktopUI {
                display: block;
            }
            
            #desktopUI #ui {
                position: fixed;
                bottom: 30px;
                left: 50%;
                transform: translateX(-50%);
                display: flex;
                gap: 15px;
                z-index: 100;
            }
            
            .weapon-btn {
                width: 60px;
                height: 60px;
                border-radius: 50%;
                border: 2px solid #ffcc00;
                background: rgba(20, 20, 30, 0.8);
                cursor: pointer;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 24px;
                color: #ffcc00;
                transition: all 0.3s;
            }
            
            .weapon-btn:hover {
                background: rgba(255, 204, 0, 0.2);
                transform: scale(1.1);
            }
            
            .weapon-btn.active {
                background: #ffcc00;
                color: #000;
                transform: scale(1.15);
                box-shadow: 0 0 20px #ffcc00;
            }
            
            #controls {
                position: fixed;
                top: 30px;
                right: 30px;
                display: flex;
                flex-direction: column;
                gap: 15px;
                z-index: 100;
            }
            
            .control-btn {
                width: 55px;
                height: 55px;
                border-radius: 50%;
                border: 2px solid #ffcc00;
                background: rgba(20, 20, 30, 0.8);
                cursor: pointer;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 22px;
                color: #ffcc00;
                transition: all 0.3s;
            }
            
            .control-btn:hover {
                background: rgba(255, 204, 0, 0.2);
            }
            
            .info-btn {
                position: fixed;
                bottom: 30px;
                right: 30px;
                width: 55px;
                height: 55px;
                border-radius: 50%;
                background: rgba(255, 204, 0, 0.9);
                border: none;
                color: #000;
                font-size: 24px;
                cursor: pointer;
                z-index: 100;
                transition: all 0.3s;
            }
            
            .info-btn:hover {
                transform: scale(1.1);
                box-shadow: 0 0 20px rgba(255, 204, 0, 0.7);
            }
            
            .modal-content {
                padding: 40px;
                width: 90%;
                max-width: 500px;
            }
            
            .modal-title {
                font-size: 28px;
            }
            
            .modal-body {
                font-size: 17px;
            }
        }
        
        /* Landscape mobile */
        @media (max-height: 600px) and (orientation: landscape) {
            #mobileWeaponsGrid {
                bottom: 10px;
                gap: 6px;
            }
            
            .mobile-weapon-btn {
                width: 45px;
                height: 45px;
                font-size: 20px;
            }
            
            #touchControls {
                bottom: 70px;
                right: 10px;
            }
            
            .touch-control-btn {
                width: 45px;
                height: 45px;
                font-size: 20px;
            }
            
            #mobileInfoBtn {
                width: 40px;
                height: 40px;
                font-size: 18px;
                top: 10px;
                right: 10px;
            }
            
            #gestureHint {
                display: none;
            }
            
            .modal-content {
                max-height: calc(100vh - 50px);
            }
        }
        
        /* Telas muito pequenas */
        @media (max-width: 320px) {
            .mobile-weapon-btn {
                width: 44px;
                height: 44px;
                font-size: 20px;
            }
            
            #mobileWeaponsGrid {
                gap: 6px;
                padding: 0 8px;
            }
            
            .modal-content {
                padding: 20px;
                width: calc(100% - 30px);
            }
            
            .modal-title {
                font-size: 22px;
            }
            
            .modal-body {
                font-size: 15px;
            }
        }
        
        /* Suporte para notch e √°reas seguras */
        @supports(padding: max(0px)) {
            #mobileWeaponsGrid {
                padding-bottom: max(15px, env(safe-area-inset-bottom));
            }
            
            .modal {
                padding-top: env(safe-area-inset-top);
                padding-bottom: env(safe-area-inset-bottom);
            }
            
            #mobileInfoBtn {
                top: max(15px, env(safe-area-inset-top));
            }
        }
    </style>
</head>
<body>
    <!-- UI Mobile -->
    <div id="mobileUI">
        <button id="mobileInfoBtn">‚Ñπ</button>
        
        <div id="mobileWeaponsGrid">
            <button class="mobile-weapon-btn active" data-id="0">ü¶á</button>
            <button class="mobile-weapon-btn" data-id="1">ü™ù</button>
            <button class="mobile-weapon-btn" data-id="2">‚ú±</button>
            <button class="mobile-weapon-btn" data-id="3">üí®</button>
            <button class="mobile-weapon-btn" data-id="4">üì°</button>
            <button class="mobile-weapon-btn" data-id="5">‚ùÑÔ∏è</button>
            <button class="mobile-weapon-btn" data-id="6">üí•</button>
            <button class="mobile-weapon-btn" data-id="7">‚ö°</button>
        </div>
        
        <div id="touchControls">
            <button class="touch-control-btn" id="mobileRotateBtn">‚Üª</button>
            <button class="touch-control-btn" id="mobileResetBtn">‚ü≤</button>
        </div>
        
        <div id="gestureHint">
            Toque e arraste para rotacionar ‚Ä¢ Pin√ßa para zoom
        </div>
    </div>
    
    <!-- UI Desktop (oculta em mobile) -->
    <div id="desktopUI">
        <button class="info-btn" id="infoBtn">‚Ñπ</button>
        
        <div id="controls">
            <button class="control-btn" id="rotateBtn">‚Üª</button>
            <button class="control-btn" id="resetBtn">‚ü≤</button>
        </div>
        
        <div id="ui">
            <button class="weapon-btn active" data-id="0">ü¶á</button>
            <button class="weapon-btn" data-id="1">ü™ù</button>
            <button class="weapon-btn" data-id="2">‚ú±</button>
            <button class="weapon-btn" data-id="3">üí®</button>
            <button class="weapon-btn" data-id="4">üì°</button>
            <button class="weapon-btn" data-id="5">‚ùÑÔ∏è</button>
            <button class="weapon-btn" data-id="6">üí•</button>
            <button class="weapon-btn" data-id="7">‚ö°</button>
        </div>
    </div>
    
    <!-- Modal -->
    <div id="weaponModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-icon" id="modalIcon">ü¶á</div>
                <h2 class="modal-title" id="modalTitle">BATARANG</h2>
                <button class="close-modal" id="closeModal">√ó</button>
            </div>
            <div class="modal-body" id="modalDescription">
                A arma de arremesso ic√¥nica do Batman em forma de morcego.
            </div>
            <div class="modal-stats">
                <div class="stat">
                    <div class="stat-value" id="statDamage">80%</div>
                    <div class="stat-label">Dano</div>
                </div>
                <div class="stat">
                    <div class="stat-value" id="statAccuracy">95%</div>
                    <div class="stat-label">Precis√£o</div>
                </div>
                <div class="stat">
                    <div class="stat-value" id="statStealth">70%</div>
                    <div class="stat-label">Furtividade</div>
                </div>
            </div>
            <div class="modal-footer">
                Arsenal do Cavaleiro das Trevas
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.min.js"></script>
    
    <script>
        let scene, camera, renderer, controls;
        let currentWeapon = null;
        let autoRotate = true;
        let weapons = [];
        let time = 0;
        let isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
        let touchStartDistance = 0;
        let initialFov = 45;

        const weaponData = [
            {
                icon: "ü¶á",
                name: "BATARANG",
                description: "A arma de arremesso ic√¥nica do Batman. Feita de uma liga met√°lica especial, pode ser arremessada com precis√£o para atordoar, desarmar ou cortar objetos √† dist√¢ncia. Retorna ao lan√ßador como um bumerangue.",
                stats: { damage: 80, accuracy: 95, stealth: 70 }
            },
            {
                icon: "ü™ù",
                name: "GRAPPLING HOOK",
                description: "Gancho de escalada de alta tecnologia. Dispara um cabo super-resistente que permite ao Batman escalar edif√≠cios rapidamente ou se balan√ßar entre pr√©dios. O motor de retra√ß√£o √© silencioso e potente.",
                stats: { damage: 30, accuracy: 90, stealth: 85 }
            },
            {
                icon: "‚ú±",
                name: "BAT-CLAW",
                description: "Garra pneum√°tica presa ao pulso. Capaz de agarrar objetos √† dist√¢ncia, escalar superf√≠cies verticais ou puxar inimigos. A garra tem for√ßa suficiente para arrancar portas de ve√≠culos.",
                stats: { damage: 65, accuracy: 85, stealth: 60 }
            },
            {
                icon: "üí®",
                name: "SMOKE PELLET",
                description: "Granada de fuma√ßa compacta. Cria uma densa nuvem de fuma√ßa em segundos, permitindo que Batman desapare√ßa rapidamente ou crie distra√ß√µes. A fuma√ßa tamb√©m bloqueia vis√£o infravermelha.",
                stats: { damage: 10, accuracy: 100, stealth: 95 }
            },
            {
                icon: "üì°",
                name: "SONIC EMITTER",
                description: "Dispositivo que emite frequ√™ncias sonoras espec√≠ficas. Pode desorientar inimigos, quebrar vidros √† dist√¢ncia ou ativar/desativar equipamentos eletr√¥nicos sens√≠veis.",
                stats: { damage: 40, accuracy: 75, stealth: 50 }
            },
            {
                icon: "‚ùÑÔ∏è",
                name: "FREEZE GRENADE",
                description: "Granada criog√™nica que congela instantaneamente tudo em um raio de 5 metros. Usada para imobilizar inimigos, criar plataformas sobre √°gua ou desativar m√°quinas.",
                stats: { damage: 70, accuracy: 80, stealth: 40 }
            },
            {
                icon: "üí•",
                name: "EXPLOSIVE GEL",
                description: "Gel explosivo aplicador. Pode ser aplicado em qualquer superf√≠cie e detonado remotamente. Usado para criar aberturas estrat√©gicas em paredes ou desativar ve√≠culos.",
                stats: { damage: 90, accuracy: 85, stealth: 55 }
            },
            {
                icon: "‚ö°",
                name: "EMP DEVICE",
                description: "Dispositivo de Pulso Eletromagn√©tico port√°til. Desativa toda eletr√¥nica em um raio de 50 metros, incluindo armas, ve√≠culos e sistemas de seguran√ßa, sem causar danos permanentes.",
                stats: { damage: 50, accuracy: 95, stealth: 75 }
            }
        ];

        const weaponShapes = [
            () => createBatarang(),
            () => createGrapplingHook(),
            () => createBatClaw(),
            () => createSmokePellet(),
            () => createSonicEmitter(),
            () => createFreezeGrenade(),
            () => createExplosiveGel(),
            () => createEMPDevice()
        ];

        function init() {
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x000000);

            const canvas = document.createElement('canvas');
            const context = canvas.getContext('webgl2') || canvas.getContext('webgl');
            const isWebGLAvailable = !!context;
            
            if (!isWebGLAvailable) {
                document.body.innerHTML = '<div style="color: #ffcc00; text-align: center; padding: 50px 20px; font-size: 18px;">‚ö†Ô∏è Seu dispositivo n√£o suporta WebGL. Por favor, atualize seu navegador ou dispositivo.</div>';
                return;
            }

            camera = new THREE.PerspectiveCamera(initialFov, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.set(0, 0, isMobile ? 15 : 12);

            renderer = new THREE.WebGLRenderer({ 
                antialias: true, 
                alpha: true,
                powerPreference: "high-performance"
            });
            renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.shadowMap.enabled = true;
            renderer.shadowMap.type = THREE.PCFSoftShadowMap;
            document.body.appendChild(renderer.domElement);

            controls = new THREE.OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;
            controls.dampingFactor = 0.05;
            controls.autoRotate = autoRotate;
            controls.autoRotateSpeed = 1.5;
            controls.enableZoom = !isMobile;
            controls.enablePan = false;
            controls.minDistance = 5;
            controls.maxDistance = 30;

            const ambientLight = new THREE.AmbientLight(0xffffff, 0.3);
            scene.add(ambientLight);

            const mainLight = new THREE.DirectionalLight(0xffcc00, 0.8);
            mainLight.position.set(10, 10, 5);
            mainLight.castShadow = true;
            mainLight.shadow.camera.left = -20;
            mainLight.shadow.camera.right = 20;
            mainLight.shadow.camera.top = 20;
            mainLight.shadow.camera.bottom = -20;
            scene.add(mainLight);

            const backLight = new THREE.DirectionalLight(0x0066ff, 0.4);
            backLight.position.set(-10, -10, -5);
            scene.add(backLight);

            const floorGeometry = new THREE.PlaneGeometry(50, 50);
            const floorMaterial = new THREE.MeshPhongMaterial({ 
                color: 0x111122,
                shininess: 100
            });
            const floor = new THREE.Mesh(floorGeometry, floorMaterial);
            floor.rotation.x = -Math.PI / 2;
            floor.position.y = -4;
            floor.receiveShadow = true;
            scene.add(floor);

            const grid = new THREE.GridHelper(50, 50, 0x222233, 0x111122);
            grid.position.y = -3.99;
            scene.add(grid);

            createAllWeapons();
            showWeapon(0);

            setupEventListeners();
            animate();

            window.addEventListener('resize', onWindowResize);
            
            // Suporte para PWA
            if ('serviceWorker' in navigator) {
                window.addEventListener('load', () => {
                    navigator.serviceWorker.register('/sw.js').catch(() => {});
                });
            }
        }

        function createAllWeapons() {
            weaponShapes.forEach((createFunc, index) => {
                const weapon = createFunc();
                weapon.visible = false;
                scene.add(weapon);
                weapons.push(weapon);
            });
        }

        function createBatarang() {
            const group = new THREE.Group();
            
            const geometry = new THREE.TorusGeometry(0.8, 0.1, 8, 16);
            const material = new THREE.MeshPhongMaterial({
                color: 0x333333,
                emissive: 0x222222,
                shininess: 100
            });
            
            const batarang = new THREE.Mesh(geometry, material);
            batarang.rotation.x = Math.PI / 2;
            group.add(batarang);
            
            // Asas adicionais
            const wingGeometry = new THREE.BoxGeometry(1.2, 0.05, 0.4);
            const wing1 = new THREE.Mesh(wingGeometry, material);
            wing1.position.y = 0.3;
            wing1.rotation.z = Math.PI / 4;
            group.add(wing1);
            
            const wing2 = new THREE.Mesh(wingGeometry, material);
            wing2.position.y = -0.3;
            wing2.rotation.z = -Math.PI / 4;
            group.add(wing2);
            
            group.scale.set(0.8, 0.8, 0.8);
            return group;
        }

        function createGrapplingHook() {
            const group = new THREE.Group();
            
            const baseGeometry = new THREE.CylinderGeometry(0.15, 0.15, 1.5, 8);
            const baseMaterial = new THREE.MeshPhongMaterial({ color: 0x444444 });
            const base = new THREE.Mesh(baseGeometry, baseMaterial);
            base.rotation.z = Math.PI / 2;
            group.add(base);
            
            const hookGeometry = new THREE.TorusGeometry(0.3, 0.06, 8, 16, Math.PI);
            const hookMaterial = new THREE.MeshPhongMaterial({ color: 0x666666 });
            const hook = new THREE.Mesh(hookGeometry, hookMaterial);
            hook.position.x = 1;
            hook.rotation.z = Math.PI / 2;
            group.add(hook);
            
            const tipGeometry = new THREE.SphereGeometry(0.08, 8, 8);
            const tipMaterial = new THREE.MeshPhongMaterial({ color: 0xff0000 });
            const tip = new THREE.Mesh(tipGeometry, tipMaterial);
            tip.position.x = 1.3;
            group.add(tip);
            
            group.scale.set(1, 1, 1);
            return group;
        }

        function createBatClaw() {
            const group = new THREE.Group();
            
            const baseGeometry = new THREE.BoxGeometry(0.8, 0.8, 0.3);
            const baseMaterial = new THREE.MeshPhongMaterial({ color: 0x222222 });
            const base = new THREE.Mesh(baseGeometry, baseMaterial);
            group.add(base);
            
            for (let i = 0; i < 3; i++) {
                const angle = (i * Math.PI * 2) / 3;
                const radius = 0.3;
                
                const clawGroup = new THREE.Group();
                
                const armGeometry = new THREE.CylinderGeometry(0.04, 0.04, 1.2, 6);
                const armMaterial = new THREE.MeshPhongMaterial({ color: 0x555555 });
                const arm = new THREE.Mesh(armGeometry, armMaterial);
                arm.rotation.z = -Math.PI / 6;
                clawGroup.add(arm);
                
                const clawGeometry = new THREE.ConeGeometry(0.06, 0.25, 6);
                const clawMaterial = new THREE.MeshPhongMaterial({ color: 0x888888 });
                const claw = new THREE.Mesh(clawGeometry, clawMaterial);
                claw.position.y = 0.6;
                claw.rotation.z = Math.PI / 2;
                clawGroup.add(claw);
                
                clawGroup.position.x = Math.cos(angle) * radius;
                clawGroup.position.z = Math.sin(angle) * radius;
                clawGroup.rotation.y = angle;
                
                group.add(clawGroup);
            }
            
            group.scale.set(1.2, 1.2, 1.2);
            return group;
        }

        function createSmokePellet() {
            const group = new THREE.Group();
            
            const sphereGeometry = new THREE.SphereGeometry(0.6, 12, 12);
            const sphereMaterial = new THREE.MeshPhongMaterial({
                color: 0x666666,
                transparent: true,
                opacity: 0.8
            });
            const sphere = new THREE.Mesh(sphereGeometry, sphereMaterial);
            group.add(sphere);
            
            const linesGroup = new THREE.Group();
            for (let i = 0; i < 6; i++) {
                const lineGeometry = new THREE.CylinderGeometry(0.015, 0.08, 0.4, 4);
                const lineMaterial = new THREE.MeshPhongMaterial({ color: 0x888888 });
                const line = new THREE.Mesh(lineGeometry, lineMaterial);
                
                const angle = (i * Math.PI * 2) / 6;
                line.position.x = Math.cos(angle) * 0.45;
                line.position.z = Math.sin(angle) * 0.45;
                line.position.y = 0;
                line.rotation.x = Math.PI / 2;
                line.rotation.z = angle;
                
                linesGroup.add(line);
            }
            linesGroup.position.y = 0.6;
            group.add(linesGroup);
            
            return group;
        }

        function createSonicEmitter() {
            const group = new THREE.Group();
            
            const baseGeometry = new THREE.CylinderGeometry(0.5, 0.6, 0.4, 12);
            const baseMaterial = new THREE.MeshPhongMaterial({ color: 0x222233 });
            const base = new THREE.Mesh(baseGeometry, baseMaterial);
            group.add(base);
            
            const dishGeometry = new THREE.SphereGeometry(0.5, 12, 12, 0, Math.PI * 2, 0, Math.PI / 2);
            const dishMaterial = new THREE.MeshPhongMaterial({ 
                color: 0x333344,
                wireframe: true
            });
            const dish = new THREE.Mesh(dishGeometry, dishMaterial);
            dish.position.y = 0.4;
            dish.rotation.x = Math.PI;
            group.add(dish);
            
            const emitterGeometry = new THREE.CylinderGeometry(0.08, 0.25, 0.6, 6);
            const emitterMaterial = new THREE.MeshPhongMaterial({ color: 0xffcc00 });
            const emitter = new THREE.Mesh(emitterGeometry, emitterMaterial);
            emitter.position.y = 0.7;
            group.add(emitter);
            
            return group;
        }

        function createFreezeGrenade() {
            const group = new THREE.Group();
            
            const coreGeometry = new THREE.IcosahedronGeometry(0.5, 0);
            const coreMaterial = new THREE.MeshPhongMaterial({
                color: 0x00aaff,
                emissive: 0x003366,
                shininess: 100
            });
            const core = new THREE.Mesh(coreGeometry, coreMaterial);
            group.add(core);
            
            const ringsGroup = new THREE.Group();
            for (let i = 0; i < 2; i++) {
                const ringGeometry = new THREE.TorusGeometry(0.7 + i * 0.15, 0.04, 6, 20);
                const ringMaterial = new THREE.MeshPhongMaterial({ color: 0x00ffff });
                const ring = new THREE.Mesh(ringGeometry, ringMaterial);
                ring.rotation.x = Math.PI / 2;
                ringsGroup.add(ring);
            }
            group.add(ringsGroup);
            
            group.scale.set(1.2, 1.2, 1.2);
            return group;
        }

        function createExplosiveGel() {
            const group = new THREE.Group();
            
            const containerGeometry = new THREE.CylinderGeometry(0.6, 0.6, 0.9, 12);
            const containerMaterial = new THREE.MeshPhongMaterial({
                color: 0x884400,
                transparent: true,
                opacity: 0.7
            });
            const container = new THREE.Mesh(containerGeometry, containerMaterial);
            group.add(container);
            
            const gelGeometry = new THREE.SphereGeometry(0.45, 12, 12);
            const gelMaterial = new THREE.MeshPhongMaterial({
                color: 0xff6600,
                emissive: 0x442200
            });
            const gel = new THREE.Mesh(gelGeometry, gelMaterial);
            gel.position.y = 0.08;
            group.add(gel);
            
            const detonatorGeometry = new THREE.BoxGeometry(0.2, 0.2, 0.2);
            const detonatorMaterial = new THREE.MeshPhongMaterial({ color: 0xff0000 });
            const detonator = new THREE.Mesh(detonatorGeometry, detonatorMaterial);
            detonator.position.y = 0.7;
            group.add(detonator);
            
            return group;
        }

        function createEMPDevice() {
            const group = new THREE.Group();
            
            const bodyGeometry = new THREE.BoxGeometry(1.2, 0.6, 0.8);
            const bodyMaterial = new THREE.MeshPhongMaterial({ color: 0x111122 });
            const body = new THREE.Mesh(bodyGeometry, bodyMaterial);
            group.add(body);
            
            const panelGeometry = new THREE.BoxGeometry(1, 0.08, 0.6);
            const panelMaterial = new THREE.MeshPhongMaterial({ color: 0x222244 });
            const panel = new THREE.Mesh(panelGeometry, panelMaterial);
            panel.position.y = 0.34;
            group.add(panel);
            
            const lightsGroup = new THREE.Group();
            for (let i = 0; i < 4; i++) {
                const lightGeometry = new THREE.BoxGeometry(0.12, 0.04, 0.12);
                const lightMaterial = new THREE.MeshPhongMaterial({ 
                    color: i % 2 === 0 ? 0x00ff00 : 0xff0000
                });
                const light = new THREE.Mesh(lightGeometry, lightMaterial);
                light.position.x = (i - 1.5) * 0.25;
                light.position.y = 0.4;
                lightsGroup.add(light);
            }
            group.add(lightsGroup);
            
            const antennaGeometry = new THREE.CylinderGeometry(0.02, 0.02, 0.6, 6);
            const antennaMaterial = new THREE.MeshPhongMaterial({ color: 0x444466 });
            const antenna = new THREE.Mesh(antennaGeometry, antennaMaterial);
            antenna.position.y = 0.7;
            antenna.rotation.x = Math.PI / 4;
            group.add(antenna);
            
            return group;
        }

        function showWeapon(index) {
            if (currentWeapon !== null) {
                weapons[currentWeapon].visible = false;
            }
            
            weapons[index].visible = true;
            currentWeapon = index;
            
            // Atualizar bot√µes ativos
            const mobileBtns = document.querySelectorAll('.mobile-weapon-btn');
            const desktopBtns = document.querySelectorAll('.weapon-btn');
            
            mobileBtns.forEach(btn => btn.classList.remove('active'));
            desktopBtns.forEach(btn => btn.classList.remove('active'));
            
            if (mobileBtns[index]) mobileBtns[index].classList.add('active');
            if (desktopBtns[index]) desktopBtns[index].classList.add('active');
            
            // Ajustar c√¢mera para mobile
            camera.position.z = isMobile ? 15 : 12;
            controls.reset();
        }

        function showWeaponModal(index) {
            const data = weaponData[index];
            
            document.getElementById('modalIcon').textContent = data.icon;
            document.getElementById('modalTitle').textContent = data.name;
            document.getElementById('modalDescription').textContent = data.description;
            document.getElementById('statDamage').textContent = data.stats.damage + '%';
            document.getElementById('statAccuracy').textContent = data.stats.accuracy + '%';
            document.getElementById('statStealth').textContent = data.stats.stealth + '%';
            
            document.getElementById('weaponModal').style.display = 'block';
            
            showWeapon(index);
        }

        function setupEventListeners() {
            // Eventos mobile
            document.querySelectorAll('.mobile-weapon-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    const id = parseInt(btn.dataset.id);
                    showWeaponModal(id);
                });
            });

            document.getElementById('mobileInfoBtn').addEventListener('click', (e) => {
                e.preventDefault();
                if (currentWeapon !== null) {
                    showWeaponModal(currentWeapon);
                }
            });

            document.getElementById('mobileRotateBtn').addEventListener('click', (e) => {
                e.preventDefault();
                autoRotate = !autoRotate;
                controls.autoRotate = autoRotate;
                const btn = document.getElementById('mobileRotateBtn');
                btn.style.background = autoRotate ? '#ffcc00' : 'rgba(20, 20, 30, 0.9)';
                btn.style.color = autoRotate ? '#000' : '#ffcc00';
            });

            document.getElementById('mobileResetBtn').addEventListener('click', (e) => {
                e.preventDefault();
                camera.position.set(0, 0, isMobile ? 15 : 12);
                controls.reset();
            });

            // Eventos desktop
            document.querySelectorAll('.weapon-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const id = parseInt(btn.dataset.id);
                    showWeaponModal(id);
                });
            });

            document.getElementById('infoBtn').addEventListener('click', () => {
                if (currentWeapon !== null) {
                    showWeaponModal(currentWeapon);
                }
            });

            document.getElementById('rotateBtn').addEventListener('click', function() {
                autoRotate = !autoRotate;
                controls.autoRotate = autoRotate;
                this.style.background = autoRotate ? '#ffcc00' : 'rgba(20, 20, 30, 0.8)';
                this.style.color = autoRotate ? '#000' : '#ffcc00';
            });

            document.getElementById('resetBtn').addEventListener('click', () => {
                camera.position.set(0, 0, isMobile ? 15 : 12);
                controls.reset();
            });

            // Eventos do modal
            document.getElementById('closeModal').addEventListener('click', () => {
                document.getElementById('weaponModal').style.display = 'none';
            });

            document.getElementById('weaponModal').addEventListener('click', (e) => {
                if (e.target === document.getElementById('weaponModal')) {
                    document.getElementById('weaponModal').style.display = 'none';
                }
            });

            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    document.getElementById('weaponModal').style.display = 'none';
                }
            });

            // Touch gestures para zoom
            if (isMobile) {
                const canvas = renderer.domElement;
                
                canvas.addEventListener('touchstart', (e) => {
                    if (e.touches.length === 2) {
                        touchStartDistance = getTouchDistance(e.touches[0], e.touches[1]);
                        e.preventDefault();
                    }
                }, { passive: false });

                canvas.addEventListener('touchmove', (e) => {
                    if (e.touches.length === 2) {
                        const currentDistance = getTouchDistance(e.touches[0], e.touches[1]);
                        const delta = touchStartDistance - currentDistance;
                        
                        // Ajustar FOV baseado no gesto de pin√ßa
                        const newFov = camera.fov + delta * 0.1;
                        camera.fov = THREE.MathUtils.clamp(newFov, 20, 70);
                        camera.updateProjectionMatrix();
                        
                        e.preventDefault();
                    }
                }, { passive: false });
            }
        }

        function getTouchDistance(touch1, touch2) {
            const dx = touch1.clientX - touch2.clientX;
            const dy = touch1.clientY - touch2.clientY;
            return Math.sqrt(dx * dx + dy * dy);
        }

        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        function animate() {
            requestAnimationFrame(animate);
            
            time += 0.016;
            
            if (currentWeapon !== null && weapons[currentWeapon]) {
                const weapon = weapons[currentWeapon];
                
                if (autoRotate) {
                    weapon.rotation.y += 0.01;
                }
                
                const float = Math.sin(time * 2) * 0.1;
                weapon.position.y = float;
                
                const pulse = Math.sin(time * 3) * 0.05 + 0.95;
                weapon.scale.set(pulse, pulse, pulse);
            }
            
            controls.update();
            renderer.render(scene, camera);
        }

        // Inicializa√ß√£o segura
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', init);
        } else {
            init();
        }
    </script>
</body>
</html>